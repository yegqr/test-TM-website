<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Word‚ÄëCloud Site ‚Ä¢ Concept</title>
  <meta name="description" content="–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π —Å–∞–π—Ç –∑ word‚Äëcloud: –∫–ª—ñ–∫ –ø–æ —Å–ª–æ–≤—É ‚Üí –≥–ª–∏–±–∏–Ω–Ω–∏–π —Ä–æ–∑–¥—ñ–ª –∑ –∞–Ω—ñ–º–∞—Ü—ñ—è–º–∏. –í–±—É–¥–æ–≤–∞–Ω–∏–π —á–∞—Ç‚Äë–≤—ñ–¥–∂–µ—Ç ChatGPT." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Merriweather:wght@300;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1116; --surface:#151925; --ink:#e9edf6; --muted:#9aa6bf; --line:rgba(255,255,255,.08);
      --brand:#7c5cff; --brand2:#44d4ff;
      --policy:#2ecc71; --research:#3498db; --media:#e67e22; --contro:#c0392b;
      --radius:18px; --shadow:0 14px 36px rgba(0,0,0,.35);
    }
    [data-theme="light"]{
      --bg:#f6f8fd; --surface:#ffffff; --ink:#0f1324; --muted:#5b667d; --line:rgba(0,0,0,.08);
      --shadow:0 10px 28px rgba(10,20,40,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); background:
        radial-gradient(900px 520px at -10% -10%, rgba(124,92,255,.16), transparent),
        radial-gradient(900px 520px at 110% 0%, rgba(68,212,255,.12), transparent),
        var(--bg);
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; line-height:1.45;
    }
    a{color:inherit}
    header{
      position:sticky; top:0; z-index:40;
      backdrop-filter:blur(10px); background:rgba(0,0,0,.18);
      border-bottom:1px solid var(--line);
    }
    .nav{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px 16px;gap:10px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;color:#fff;font-weight:800;background:conic-gradient(from 180deg,var(--brand),var(--brand2),var(--brand)); box-shadow:var(--shadow)}
    .nav .links{display:flex;gap:12px;flex-wrap:wrap}
    .link{padding:8px 10px;border-radius:10px;border:1px solid transparent}
    .link:hover{border-color:var(--line);background:rgba(255,255,255,.04)}
    .actions{display:flex;gap:8px}
    button{appearance:none;border:none;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:var(--surface);color:var(--ink);font-weight:700;cursor:pointer}
    .primary{background:linear-gradient(90deg,var(--brand),var(--brand2)); color:#0c0f17}
    main{max-width:1200px;margin:0 auto;padding:16px;display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
    @media (max-width:980px){ main{grid-template-columns:1fr} }

    /* Cloud card */
    .card{background:var(--surface);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
    .cloudWrap{position:relative;min-height:68vh;display:grid}
    .legend{position:absolute;left:12px;bottom:12px;display:flex;gap:10px;flex-wrap:wrap;font-size:12px;background:rgba(0,0,0,.18);backdrop-filter:blur(8px);padding:8px 10px;border-radius:12px;border:1px solid var(--line)}
    .dot{width:10px;height:10px;border-radius:50% ;display:inline-block;margin-right:6px}
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 0 0}
    .filters .pill{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:rgba(255,255,255,.02);cursor:pointer;font-weight:700}
    .filters .pill.active{outline:2px solid var(--brand);outline-offset:-2px}

    /* Details (desktop side panel) */
    .details{padding:14px;display:flex;flex-direction:column;gap:12px}
    .heroBox{position:relative;aspect-ratio:16/10;border-radius:14px;border:1px solid var(--line);overflow:hidden;background:rgba(255,255,255,.02)}
    .heroImg{position:absolute;inset:0;background:url('https://placehold.co/1200x800?text=Image') center/cover no-repeat;transition:transform .6s ease}
    .overlayText{position:absolute;inset:auto 0 0 0;background:linear-gradient(to top, rgba(0,0,0,.45), transparent);color:#fff;padding:10px 12px;font-weight:700}
    .flipNote{font-size:12px;color:var(--muted)}
    h1,h2,h3{font-family:Merriweather,serif;letter-spacing:.2px}
    h1{font-size:36px;margin:0}
    .muted{color:var(--muted)}
    .list{display:grid;gap:10px}
    .item{padding:12px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.02)}

    /* Mobile full-screen sheet for details */
    .sheet{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:flex-end;z-index:50}
    .sheet.open{display:flex}
    .sheet .panel{background:var(--surface);border-radius:18px 18px 0 0;border:1px solid var(--line);box-shadow:var(--shadow);width:100%;max-height:88vh;overflow:auto;transform:translateY(4%);animation:pop .35s ease both}
    @keyframes pop{from{transform:translateY(8%);opacity:0}to{transform:translateY(0);opacity:1}}
    .sheetHeader{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid var(--line)}
    .flipWrap{perspective:1000px}
    .flip{position:relative;height:220px;transform-style:preserve-3d;transition:transform .6s}
    .flip .front,.flip .back{position:absolute;inset:0;border-radius:14px;border:1px solid var(--line);backface-visibility:hidden;overflow:hidden}
    .flip .front{background:url('https://placehold.co/1000x700?text=Tap+to+flip') center/cover}
    .flip .back{background:rgba(255,255,255,.02);transform:rotateY(180deg);display:flex;align-items:center;justify-content:center;padding:16px}
    .flip.flipped{transform:rotateY(180deg)}
    .sheetBody{padding:12px}
    .chip{display:inline-flex;gap:6px;align-items:center;padding:5px 10px;border:1px solid var(--line);border-radius:999px;margin-right:6px}

    /* Zoom transition helper */
    .zoomGhost{position:fixed;z-index:60;pointer-events:none;will-change:transform,opacity}

    /* Chat widget */
    .chatBtn{position:fixed;right:16px;bottom:16px;z-index:60;background:linear-gradient(90deg,var(--brand),var(--brand2));color:#0c0f17;border:none;border-radius:999px;padding:12px 14px;font-weight:800;box-shadow:var(--shadow);cursor:pointer}
    .chat{position:fixed;right:16px;bottom:76px;width:360px;max-height:60vh;display:none;flex-direction:column;background:var(--surface);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);overflow:hidden;z-index:60}
    .chat.open{display:flex}
    .chatHead{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--line)}
    .chatBody{padding:10px;display:flex;flex-direction:column;gap:8px;overflow:auto}
    .msg{padding:10px 12px;border-radius:12px;max-width:80%}
    .me{align-self:flex-end;background:rgba(124,92,255,.18);border:1px solid rgba(124,92,255,.35)}
    .ai{align-self:flex-start;background:rgba(255,255,255,.03);border:1px solid var(--line)}
    .chatForm{display:flex;gap:8px;padding:10px;border-top:1px solid var(--line)}
    .chatForm input{flex:1;padding:10px;border-radius:10px;border:1px solid var(--line);background:rgba(255,255,255,.02);color:var(--ink)}
    @media (max-width:520px){
      .chat{right:8px;left:8px;width:auto;max-height:70vh}
      .chatBtn{right:8px;bottom:12px}
    }

    .sr{position:absolute;left:-9999px}
  </style>
</head>
<body data-theme="dark">
  <header>
    <div class="nav">
      <div class="brand">
        <div class="logo">WC</div>
        <div>
          <div style="font-weight:800">Word‚ÄëCloud Concept</div>
          <div class="muted" style="font-size:12px">–∫–ª—ñ–∫ –ø–æ —Å–ª–æ–≤—É ‚Üí –≥–ª–∏–±–∏–Ω–Ω–∏–π —Ä–æ–∑–¥—ñ–ª</div>
        </div>
      </div>
      <div class="links">
        <a class="link" href="#cloud">Cloud</a>
        <a class="link" href="#sections">–†–æ–∑–¥—ñ–ª–∏</a>
      </div>
      <div class="actions">
        <button id="themeBtn">üåì –¢–µ–º–∞</button>
      </div>
    </div>
  </header>

  <main>
    <!-- Left: Word Cloud -->
    <section id="cloud" class="card cloudWrap">
      <svg id="cloudSvg" role="img" aria-label="–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π word‚Äëcloud"></svg>
      <div class="legend">
        <span><i class="dot" style="background:var(--policy)"></i>–ü–æ–ª—ñ—Ç–∏–∫–∞</span>
        <span><i class="dot" style="background:var(--research)"></i>–î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è</span>
        <span><i class="dot" style="background:var(--media)"></i>–ú–µ–¥—ñ–∞</span>
        <span><i class="dot" style="background:var(--contro)"></i>–î–µ–±–∞—Ç–∏</span>
      </div>
      <div class="filters" id="filters" style="position:absolute;right:12px;bottom:12px"></div>
    </section>

    <!-- Right: Details (desktop) -->
    <aside class="card details" id="details">
      <div>
        <h1 id="dTitle">–û–±–µ—Ä–∏ —Ç–µ–º—É –Ω–∞ –≤–æ—Ä–¥–∫–ª–∞—É–¥—ñ</h1>
        <div class="muted" id="dKicker">–ö–ª—ñ–∫–Ω–∏/—Ç–∞–ø–Ω–∏ —Å–ª–æ–≤–æ ‚Äî –ø–æ–±–∞—á–∏—à –ø–ª–∞–≤–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ —Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç.</div>
      </div>
      <div class="heroBox">
        <div class="heroImg" id="heroImg"></div>
        <div class="overlayText" id="heroOverlay">–ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è ‚Äî –Ω–∞ –º–æ–±—ñ–ª—Ü—ñ –≤–æ–Ω–æ ‚Äú–ø–µ—Ä–µ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è‚Äù —É —Ç–µ–∫—Å—Ç</div>
      </div>
      <div class="flipNote">–ü—ñ–¥–∫–∞–∑–∫–∞: –Ω–∞ –º–æ–±—ñ–ª—Ü—ñ —Ü–µ–π —Ä–æ–∑–¥—ñ–ª –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è —è–∫ —Ñ—É–ª—Å–∫—Ä—ñ–Ω‚Äë–∫–∞—Ä—Ç–∫–∞ –∑ flip‚Äë–∞–Ω—ñ–º–∞—Ü—ñ—î—é.</div>
      <div id="dChips"></div>
      <div class="list" id="dList"></div>
    </aside>
  </main>

  <!-- Mobile sheet -->
  <div class="sheet" id="sheet">
    <div class="panel">
      <div class="sheetHeader">
        <strong id="mTitle">Section</strong>
        <button id="closeSheet">‚úï</button>
      </div>
      <div class="sheetBody">
        <div class="flipWrap" style="margin-bottom:10px">
          <div class="flip" id="flip">
            <div class="front"></div>
            <div class="back"><div>–¢—É—Ç —Ç–µ–∫—Å—Ç —Ä–æ–∑–¥—ñ–ª—É. –¢–∞–ø–Ω–∏ –∫–∞—Ä—Ç–∫—É —â–µ —Ä–∞–∑ ‚Äî –ø–æ–≤–µ—Ä–Ω–µ—Ç—å—Å—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.</div></div>
          </div>
        </div>
        <div id="mChips" style="margin-bottom:8px"></div>
        <div class="list" id="mList"></div>
      </div>
    </div>
  </div>

  <!-- Chat widget -->
  <button class="chatBtn" id="chatBtn">üí¨ –ß–∞—Ç</button>
  <div class="chat" id="chatBox" aria-live="polite">
    <div class="chatHead">
      <div><strong>–ü–æ–º—ñ—á–Ω–∏–∫</strong> <span class="muted" style="font-size:12px">on‚Äësite</span></div>
      <button id="chatClose">‚úï</button>
    </div>
    <div class="chatBody" id="chatBody">
      <div class="msg ai">–ü—Ä–∏–≤—ñ—Ç! –ü–æ—è—Å–Ω–∏—Ç–∏ —è–∫ –ø—Ä–∞—Ü—é—î —Å–∞–π—Ç –∞–±–æ —Ä–æ–∑–ø–æ–≤—ñ—Å—Ç–∏ –ø—Ä–æ —Ä–æ–∑–¥—ñ–ª?</div>
    </div>
    <form class="chatForm" id="chatForm">
      <input id="chatInput" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." autocomplete="off" />
      <button class="primary" type="submit">‚ñ∂Ô∏é</button>
    </form>
  </div>

  <span class="sr" id="voiceTTSEnabled" aria-hidden="true"></span>

  <!-- Libs -->
  <script src="https://unpkg.com/d3@7"></script>
  <script src="https://unpkg.com/d3-cloud/build/d3.layout.cloud.js"></script>

  <script>
    // ------------- Data -------------
    const CATS = {
      policy:{name:"–ü–æ–ª—ñ—Ç–∏–∫–∞", color:getComputedStyle(document.documentElement).getPropertyValue('--policy').trim()},
      research:{name:"–î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è", color:getComputedStyle(document.documentElement).getPropertyValue('--research').trim()},
      media:{name:"–ú–µ–¥—ñ–∞", color:getComputedStyle(document.documentElement).getPropertyValue('--media').trim()},
      contro:{name:"–î–µ–±–∞—Ç–∏", color:getComputedStyle(document.documentElement).getPropertyValue('--contro').trim()},
    };

    // –°–ª–æ–≤–∞ –¥–ª—è —Ö–º–∞—Ä–∏ (–∑–∞–º—ñ–Ω–∏ —Å–≤–æ—ó–º–∏). weight 20..80
    const WORDS = [
      {text:"Policy Work", weight:76, cat:"policy", slug:"policy-work"},
      {text:"KSE", weight:50, cat:"policy", slug:"kse"},
      {text:"NBU Council", weight:46, cat:"policy", slug:"nbu"},
      {text:"Research", weight:70, cat:"research", slug:"research"},
      {text:"Microeconomic Theory", weight:40, cat:"research", slug:"micro"},
      {text:"Game Theory", weight:44, cat:"research", slug:"games"},
      {text:"Teaching", weight:52, cat:"research", slug:"teaching"},
      {text:"Media & Talks", weight:48, cat:"media", slug:"media"},
      {text:"Public Essays", weight:34, cat:"media", slug:"essays"},
      {text:"Debates & Q&A", weight:38, cat:"contro", slug:"debates"},
      {text:"Press Statements", weight:32, cat:"media", slug:"press"},
    ];

    // –í–º—ñ—Å—Ç —Ä–æ–∑–¥—ñ–ª—ñ–≤ (–¥–µ–º–æ). –ó–∞–º—ñ–Ω—é–π —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏.
    const SECTIONS = {
      "policy-work":{
        title:"Policy Work",
        img:"https://placehold.co/1200x800/111214/FFFFFF?text=Policy+Work",
        tags:["–ø–æ–ª—ñ—Ç–∏–∫–∞","–µ–∫–æ–Ω–æ–º—ñ–∫–∞"],
        blocks:[
          {title:"–†–æ–ª—å —ñ —Ñ–æ–∫—É—Å", text:"–û–ø–∏—Å –≤–ø–ª–∏–≤—É –Ω–∞ –µ–∫–æ–Ω–æ–º—ñ—á–Ω—É –ø–æ–ª—ñ—Ç–∏–∫—É, –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —ñ–Ω—Å—Ç–∏—Ç—É—Ü—ñ–π, —Ä–∏–Ω–∫–æ–≤–∏–π –¥–∏–∑–∞–π–Ω."},
          {title:"–ü—Ä–∏–∫–ª–∞–¥–∏", text:"–û–∫—Ä–µ–º—ñ –∫–µ–π—Å–∏/–ø—Ä–æ—î–∫—Ç–∏ –∑ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –≤–∏—Å–Ω–æ–≤–∫–∞–º–∏ (–º–æ–∂–Ω–∞ –ª—ñ–Ω–∫–∏)."}
        ]
      },
      "kse":{
        title:"KSE",
        img:"https://placehold.co/1200x800/121522/FFFFFF?text=KSE",
        tags:["–æ—Å–≤—ñ—Ç–∞","–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞"],
        blocks:[
          {title:"–ü—Ä–æ–≥—Ä–∞–º–∏", text:"–û—Å–≤—ñ—Ç–Ω—ñ –π –¥–æ—Å–ª—ñ–¥–Ω–∏—Ü—å–∫—ñ —ñ–Ω—ñ—Ü—ñ–∞—Ç–∏–≤–∏, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–∞, –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω—ñ –ø—Ä–æ—î–∫—Ç–∏."}
        ]
      },
      "nbu":{
        title:"NBU Council",
        img:"https://placehold.co/1200x800/141822/FFFFFF?text=NBU",
        tags:["—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π –±–∞–Ω–∫","–º–æ–Ω–µ—Ç–∞—Ä–Ω–∞ –ø–æ–ª—ñ—Ç–∏–∫–∞"],
        blocks:[
          {title:"–û–≥–ª—è–¥", text:"–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —É—á–∞—Å—Ç—ñ –≤ –†–∞–¥—ñ –ù–ë–£ —Ç–∞ —Ñ–æ–∫—É—Å–∏ —Ä–æ–±–æ—Ç–∏."}
        ]
      },
      "research":{
        title:"Research",
        img:"https://placehold.co/1200x800/16202b/FFFFFF?text=Research",
        tags:["–º—ñ–∫—Ä–æ","—Ç–µ–æ—Ä—ñ—è —ñ–≥–æ—Ä"],
        blocks:[
          {title:"–¢–µ–º–∏", text:"–ú—ñ–∫—Ä–æ–µ–∫–æ–Ω–æ–º—ñ—á–Ω–∞ —Ç–µ–æ—Ä—ñ—è, –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏, —ñ–Ω—Å—Ç–∏—Ç—É—Ü—ñ–π–Ω–∏–π –¥–∏–∑–∞–π–Ω."},
          {title:"–ü–æ—Å–∏–ª–∞–Ω–Ω—è", text:"Google Scholar / SSRN."}
        ]
      },
      "micro":{title:"Microeconomic Theory", img:"https://placehold.co/1200x800/1b2430/FFFFFF?text=Micro", tags:["–º—ñ–∫—Ä–æ"], blocks:[{title:"–û–≥–ª—è–¥", text:"–û–ø–∏—Å –Ω–∞–ø—Ä—è–º—É / –∫—É—Ä—Å–∏ / –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó."}]},
      "games":{title:"Game Theory", img:"https://placehold.co/1200x800/1e2a38/FFFFFF?text=Game+Theory", tags:["—Ç–µ–æ—Ä—ñ—è —ñ–≥–æ—Ä"], blocks:[{title:"–û–≥–ª—è–¥", text:"–°—Ç–∏—Å–ª–∞ –¥–æ–≤—ñ–¥–∫–∞ + –∫–µ–π—Å–∏."}]},
      "teaching":{title:"Teaching", img:"https://placehold.co/1200x800/202d3d/FFFFFF?text=Teaching", tags:["–∫—É—Ä—Å–∏"], blocks:[{title:"–ö—É—Ä—Å–∏", text:"–°–∏–ª–ª–∞–±—É—Å–∏, –≤—ñ–¥–µ–æ–ª–µ–∫—Ü—ñ—ó, –º–∞—Ç–µ—Ä—ñ–∞–ª–∏."}]},
      "media":{title:"Media & Talks", img:"https://placehold.co/1200x800/243346/FFFFFF?text=Media+%26+Talks", tags:["–º–µ–¥—ñ–∞"], blocks:[{title:"–í–∏—Å—Ç—É–ø–∏", text:"–ü—É–±–ª—ñ—á–Ω—ñ –ª–µ–∫—Ü—ñ—ó, —ñ–Ω—Ç–µ—Ä–≤'—é, –ø–æ–¥–∫–∞—Å—Ç–∏."}]},
      "essays":{title:"Public Essays", img:"https://placehold.co/1200x800/283a52/FFFFFF?text=Essays", tags:["–µ—Å–µ"], blocks:[{title:"–î–æ–±—ñ—Ä–∫–∞", text:"–ö–æ–ª–æ–Ω–∫–∏/–µ—Å–µ –∑ –ª—ñ–Ω–∫–∞–º–∏."}]},
      "debates":{title:"Debates & Q&A", img:"https://placehold.co/1200x800/2c405b/FFFFFF?text=Debates", tags:["Q&A"], blocks:[{title:"–ü—Ä–∞–≤–∏–ª–∞", text:"–í—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ —á–∞—Å—Ç—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, –ø–æ–∑–∏—Ü—ñ—ó, –∞—Ä–≥—É–º–µ–Ω—Ç–∏."}]},
      "press":{title:"Press Statements", img:"https://placehold.co/1200x800/304766/FFFFFF?text=Press", tags:["–ø—Ä–µ—Å-—Å–ª—É–∂–±–∞"], blocks:[{title:"–û—Ñ—ñ—Ü—ñ–π–Ω—ñ –∑–∞—è–≤–∏", text:"–õ–∞–∫–æ–Ω—ñ—á–Ω—ñ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —ñ–∑ –¥–∞—Ç–∞–º–∏ —Ç–∞ –¥–∂–µ—Ä–µ–ª–∞–º–∏."}]},
    };

    // ------------- Theme -------------
    const themeBtn = document.getElementById('themeBtn');
    const savedTheme = localStorage.getItem('wc_theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    themeBtn.onclick = ()=> {
      const next = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', next);
      localStorage.setItem('wc_theme', next);
      redrawCloud(); // –∫–æ–ª—å–æ—Ä–∏ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω–∏—Ç–∏—Å—å
    };

    // ------------- Cloud (desktop + mobile) -------------
    const svg = d3.select('#cloudSvg');
    let layout, g;
    let activeCats = new Set(Object.keys(CATS));

    // Pills-—Ñ—ñ–ª—å—Ç—Ä–∏
    const filters = document.getElementById('filters');
    Object.entries(CATS).forEach(([id,cat])=>{
      const pill = document.createElement('button');
      pill.className = 'pill active';
      pill.textContent = cat.name;
      pill.onclick = ()=>{
        if(activeCats.has(id)){ activeCats.delete(id); pill.classList.remove('active'); }
        else{ activeCats.add(id); pill.classList.add('active'); }
        redrawCloud();
      };
      filters.appendChild(pill);
    });

    function redrawCloud(){
      // –†–æ–∑–º—ñ—Ä
      const wrap = document.querySelector('.cloudWrap');
      const w = wrap.clientWidth, h = Math.max(440, wrap.clientHeight);
      svg.attr('width', w).attr('height', h).html(''); // clear
      g = svg.append('g').attr('transform', `translate(${w/2}, ${h/2})`);

      const scale = d3.scaleLinear().domain([20,80]).range([16, 72 * (w<520?0.7:1)]);
      const visible = WORDS.filter(d=>activeCats.has(d.cat));
      layout = d3.layout.cloud()
        .size([w, h])
        .words(visible.map(d => ({...d, size: Math.round(scale(d.weight))})))
        .padding(2)
        .rotate(()=> (Math.random()<0.35 ? 90 : 0))
        .font('Merriweather')
        .fontSize(d=>d.size)
        .on('end', draw);
      layout.start();
    }

    function draw(words){
      const colorByCat = (cat)=> {
        const s = getComputedStyle(document.documentElement);
        const map = {policy:'--policy', research:'--research', media:'--media', contro:'--contro'};
        return s.getPropertyValue(map[cat] || '--brand').trim();
      };

      const selection = g.selectAll('text')
        .data(words)
        .enter().append('text')
          .attr('text-anchor','middle')
          .style('font-size', d=>d.size + 'px')
          .style('font-family','Merriweather,serif')
          .style('fill', d=> colorByCat(d.cat))
          .style('cursor','pointer')
          .attr('transform', d => `translate(${d.x},${d.y}) rotate(${d.rotate})`)
          .text(d=>d.text)
          .on('click', function(e,d){ goDeep(this, d); });

      // –≤—Ö—ñ–¥–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è
      selection
        .style('opacity',0).transition().duration(600)
        .style('opacity',1);
    }

    // ------------- Deep link / zoom transition -------------
    const dTitle = document.getElementById('dTitle');
    const dKicker = document.getElementById('dKicker');
    const heroImg = document.getElementById('heroImg');
    const dChips = document.getElementById('dChips');
    const dList = document.getElementById('dList');

    const sheet = document.getElementById('sheet');
    const closeSheet = document.getElementById('closeSheet');
    const mTitle = document.getElementById('mTitle');
    const mChips = document.getElementById('mChips');
    const mList = document.getElementById('mList');
    const flip = document.getElementById('flip');

    function goDeep(node, d){
      const sec = SECTIONS[d.slug] || {title:d.text, img:'https://placehold.co/1200x800?text=Section', tags:[], blocks:[]};
      const rect = node.getBoundingClientRect();
      // ghost –¥–ª—è zoom-–∞–Ω—ñ–º–∞—Ü—ñ—ó
      const ghost = document.createElement('div');
      ghost.className = 'zoomGhost';
      ghost.textContent = d.text;
      ghost.style.font = getComputedStyle(node).font;
      ghost.style.color = getComputedStyle(node).color;
      ghost.style.left = rect.left + 'px';
      ghost.style.top = rect.top + 'px';
      ghost.style.transform = 'translate(0,0) scale(1)';
      ghost.style.opacity = '1';
      document.body.appendChild(ghost);
      const target = document.querySelector('#details').getBoundingClientRect();
      const tx = target.left + 16 - rect.left;
      const ty = target.top + 16 - rect.top;
      ghost.animate([
        { transform:'translate(0,0) scale(1)', opacity:1 },
        { transform:`translate(${tx}px, ${ty}px) scale(${Math.min(1.6, target.width/rect.width)})`, opacity:0 }
      ], {duration:550, easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish = ()=> ghost.remove();

      // –æ–Ω–æ–≤–ª—é—î–º–æ –ø–∞–Ω–µ–ª—å (desktop)
      dTitle.textContent = sec.title;
      dKicker.textContent = '–í–∏–±—Ä–∞–Ω–∏–π —Ä–æ–∑–¥—ñ–ª: ' + (CATS[d.cat]?.name || '');
      heroImg.style.backgroundImage = `url('${sec.img}')`;
      dChips.innerHTML = (sec.tags||[]).map(t=> `<span class="chip">#${t}</span>`).join('');
      dList.innerHTML = (sec.blocks||[]).map(b=> `<div class="item"><strong>${b.title}</strong><div>${b.text}</div></div>`).join('');
      history.pushState({slug:d.slug}, '', '#'+d.slug);

      // mobile: –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ sheet
      if(window.matchMedia('(max-width: 980px)').matches){
        mTitle.textContent = sec.title;
        mChips.innerHTML = dChips.innerHTML;
        mList.innerHTML = dList.innerHTML;
        sheet.classList.add('open');
        // flip reset
        flip.classList.remove('flipped');
      }
    }

    closeSheet.onclick = ()=> sheet.classList.remove('open');
    flip.onclick = ()=> flip.classList.toggle('flipped');
    heroImg.onclick = ()=> heroImg.style.transform = heroImg.style.transform ? '' : 'scale(1.05)';

    window.addEventListener('popstate', ()=>{
      const slug = (location.hash||'').replace('#','');
      if(slug && SECTIONS[slug]){
        // —è–∫—â–æ –ø—Ä–∏–π—à–ª–∏ –ø–æ –ø—Ä—è–º–æ–º—É –ª—ñ–Ω–∫—É ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–º–∞–ª—é—î–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç
        const fake = {slug, cat:Object.keys(CATS)[0], text:SECTIONS[slug].title};
        goDeep(document.querySelector('#cloudSvg'), fake);
      }
    });

    // ------------- Chat widget (calls /api/chat) -------------
    const chatBtn = document.getElementById('chatBtn');
    const chatBox = document.getElementById('chatBox');
    const chatClose = document.getElementById('chatClose');
    const chatBody = document.getElementById('chatBody');
    const chatForm = document.getElementById('chatForm');
    const chatInput = document.getElementById('chatInput');
    let thread = [{role:'assistant', content:'–ü—Ä–∏–≤—ñ—Ç! –ü–æ—è—Å–Ω–∏—Ç–∏ —è–∫ –ø—Ä–∞—Ü—é—î —Å–∞–π—Ç –∞–±–æ —Ä–æ–∑–ø–æ–≤—ñ—Å—Ç–∏ –ø—Ä–æ —Ä–æ–∑–¥—ñ–ª?'}];

    chatBtn.onclick = ()=> chatBox.classList.toggle('open');
    chatClose.onclick = ()=> chatBox.classList.remove('open');

    chatForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const text = chatInput.value.trim();
      if(!text) return;
      chatInput.value = '';
      addMsg('user', text);
      thread.push({role:'user', content:text});
      const ctx = currentContext();
      addMsg('assistant', '‚Ä¶ –¥—Ä—É–∫—É—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å', true);
      try{
        const res = await fetch('/api/chat', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({messages: thread.slice(-10), context: ctx})
        });
        const data = await res.json();
        removeTyping();
        const reply = data?.reply?.content || '–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.';
        addMsg('assistant', reply);
        thread.push({role:'assistant', content:reply});
      }catch(err){
        removeTyping();
        addMsg('assistant', '–í–∏–±–∞—á, –Ω–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —á–∞—Ç—É.');
      }
    });

    function addMsg(role, text, typing=false){
      const div = document.createElement('div');
      div.className = 'msg ' + (role==='user'?'me':'ai') + (typing?' typing':'');
      div.textContent = text;
      chatBody.appendChild(div);
      chatBody.scrollTop = chatBody.scrollHeight;
    }
    function removeTyping(){
      const t = chatBody.querySelector('.typing');
      if(t) t.remove();
    }
    function currentContext(){
      // –ü–µ—Ä–µ–¥–∞—î–º–æ —á–∞—Å—Ç–∏–Ω–∫—É –∫–æ–Ω—Ç–µ–Ω—Ç—É —Ä–æ–∑–¥—ñ–ª—É –¥–ª—è –∫—Ä–∞—â–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
      const title = document.getElementById('dTitle').textContent;
      const blocks = [...document.querySelectorAll('#dList .item')].map(x=>x.innerText).join('\n‚Äî ');
      return `–†–æ–∑–¥—ñ–ª: ${title}\n–ü—É–Ω–∫—Ç–∏:\n‚Äî ${blocks}`;
    }

    // ------------- Init -------------
    window.addEventListener('resize', debounce(redrawCloud, 200));
    function debounce(fn,ms){ let t; return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a),ms)}}
    redrawCloud();

  </script>
</body>
</html>
